<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Aero Fighter Clone</title>
    <style>
        /* --- ESTILOS GERAIS E LAYOUT --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Arial', sans-serif;
            background-color: #111;
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }
        #game-container {
            position: relative;
            aspect-ratio: 9 / 16;
            height: 98vh;
            max-height: 98vh;
            width: calc(98vh * (9 / 16));
            max-width: 100vw;
            background-color: #000;
            overflow: hidden;
            border: 2px solid #333;
            cursor: crosshair; /* Cursor para jogo */
        }
        canvas {
            width: 100%;
            height: 100%;
            display: block;
            background-image:
                radial-gradient(white 1px, transparent 0),
                radial-gradient(white 1px, transparent 0);
            background-size: 40px 40px, 40px 40px;
            background-position: 0 0, 20px 20px;
            animation: scroll-background 10s linear infinite;
        }
        @keyframes scroll-background {
            from { background-position-y: 0px; }
            to { background-position-y: 400px; }
        }
        /* --- MENUS E INTERFACES --- */
        .overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 20px;
        }
        .overlay h1 { font-size: 2.5em; margin-bottom: 20px; text-shadow: 0 0 10px #0ff; }
        .overlay p { font-size: 1.2em; margin-bottom: 30px; }
        .button {
            padding: 15px 30px; font-size: 1.5em; background-color: #0af; border: none;
            color: #fff; cursor: pointer; border-radius: 5px; transition: background-color 0.3s;
        }
        .button:hover { background-color: #08d; }
        #game-ui {
            position: absolute; top: 10px; left: 10px; right: 10px; font-size: 1.2em;
            text-shadow: 1px 1px 2px #000; display: flex; flex-direction: column; gap: 8px;
        }
        #ui-top-row { display: flex; justify-content: space-between; }
        .health-bar-container { width: 120px; height: 20px; background-color: #555; border: 1px solid #fff; border-radius: 5px; overflow: hidden; }
        .health-bar-fill { width: 100%; height: 100%; background-color: #4caf50; transition: width 0.2s linear; }
        
        /* --- CONTROLES VIRTUAIS --- */
        #virtual-controls {
            position: absolute; bottom: 20px; left: 20px; right: 20px; display: flex;
            justify-content: space-between; align-items: flex-end; pointer-events: none;
        }
        #d-pad {
            display: grid; grid-template-areas: ". up ." "left . right" ". down .";
            gap: 10px; pointer-events: all;
        }
        .d-pad-btn {
            width: 60px; height: 60px; background-color: rgba(255, 255, 255, 0.3); border: 2px solid rgba(255, 255, 255, 0.5);
            border-radius: 15px; display: flex; justify-content: center; align-items: center; font-size: 2em; color: #fff;
        }
        .d-pad-btn:active { background-color: rgba(255, 255, 255, 0.6); }
        #up-btn { grid-area: up; } #down-btn { grid-area: down; } #left-btn { grid-area: left; } #right-btn { grid-area: right; }
        #action-buttons { display: flex; flex-direction: column; gap: 15px; pointer-events: all; }
        .action-btn {
            width: 80px; height: 80px; border-radius: 50%; background-color: rgba(255, 80, 80, 0.5);
            border: 2px solid rgba(255, 255, 255, 0.5); display: flex; justify-content: center;
            align-items: center; font-size: 1.2em; color: #fff; font-weight: bold;
        }
        .action-btn:active { background-color: rgba(255, 80, 80, 0.8); }
        #special-btn { background-color: rgba(80, 80, 255, 0.5); }
        #special-btn:active { background-color: rgba(80, 80, 255, 0.8); }
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div id="game-container">
        <canvas id="gameCanvas"></canvas>
        <div id="main-menu" class="overlay">
            <h1>Aero Fighter</h1><p>Maior Pontuação: <span id="high-score-display">0</span></p>
            <button id="start-btn" class="button">Iniciar Jogo</button>
        </div>
        <div id="game-ui" class="hidden">
            <div id="ui-top-row"><span id="score">Pontos: 0</span><span id="time">Tempo: 0s</span></div>
            <div class="health-bar-container"><div id="health-bar" class="health-bar-fill"></div></div>
        </div>
        <div id="game-over-screen" class="overlay hidden">
             <h1>Fim de Jogo</h1><p>Sua pontuação: <span id="final-score">0</span></p>
            <button id="restart-btn" class="button">Jogar Novamente</button>
        </div>
        <div id="virtual-controls" class="hidden">
            <div id="d-pad">
                <button id="up-btn" class="d-pad-btn">▲</button><button id="left-btn" class="d-pad-btn">◀</button>
                <button id="right-btn" class="d-pad-btn">▶</button><button id="down-btn" class="d-pad-btn">▼</button>
            </div>
            <div id="action-buttons">
                 <button id="special-btn" class="action-btn">Especial</button><button id="shoot-btn" class="action-btn">Atirar</button>
            </div>
        </div>
    </div>

    <script>
        window.onload = function() {
            // --- SETUP INICIAL ---
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            const uiElements = {
                mainMenu: document.getElementById('main-menu'),
                gameUI: document.getElementById('game-ui'),
                gameOverScreen: document.getElementById('game-over-screen'),
                virtualControls: document.getElementById('virtual-controls'),
                startBtn: document.getElementById('start-btn'),
                restartBtn: document.getElementById('restart-btn'),
                scoreDisplay: document.getElementById('score'),
                timeDisplay: document.getElementById('time'),
                finalScoreDisplay: document.getElementById('final-score'),
                highScoreDisplay: document.getElementById('high-score-display'),
                healthBarFill: document.getElementById('health-bar')
            };
            
            canvas.width = 540; canvas.height = 960;
            const isMobile = /Mobi|Android|iPhone/i.test(navigator.userAgent);

            // --- ESTADO DO JOGO ---
            let gameStarted, gameOver, score, gameStartTime, lastSpawnTime, spawnCooldown;
            let highScore = localStorage.getItem('aeroFighterHighScore') || 0;
            uiElements.highScoreDisplay.textContent = highScore;

            // --- OBJETOS DO JOGO ---
            let player, projectiles, enemies, enemyProjectiles, powerups;
            
            const keys = {
                w: false, a: false, s: false, d: false, j: false, f: false
            };
            const mouse = { down: false };

            const playerSettings = {
                width: 50, height: 50, speed: 5, maxHealth: 10,
                shootCooldown: 200, lastShotTime: 0,
                specialCooldown: 15000, lastSpecialTime: -15000,
                hitInvincibilityDuration: 300
            };
            const projectileColors = ['#00FF00', '#00FFFF', '#FFFF00', '#FF00FF']; // 2, 3, 4, 5 tiros

            // --- FUNÇÕES DE CONTROLE DO JOGO ---
            function initGame() {
                uiElements.mainMenu.classList.add('hidden');
                uiElements.gameOverScreen.classList.add('hidden');
                uiElements.gameUI.classList.remove('hidden');
                if (isMobile) uiElements.virtualControls.classList.remove('hidden');

                gameStarted = true; gameOver = false; score = 0;
                gameStartTime = Date.now(); lastSpawnTime = Date.now(); spawnCooldown = 2000;

                projectiles = []; enemies = []; enemyProjectiles = []; powerups = [];
                
                player = {
                    x: canvas.width / 2 - playerSettings.width / 2, y: canvas.height - 100,
                    width: playerSettings.width, height: playerSettings.height, speed: playerSettings.speed,
                    health: playerSettings.maxHealth, isHit: false, lastHitTime: 0,
                    shotCount: 2, projectileSpeed: 8
                };
                
                updateUIDisplay();
                gameLoop();
            }

            function endGame() {
                gameOver = true; gameStarted = false;
                uiElements.gameUI.classList.add('hidden');
                if (isMobile) uiElements.virtualControls.classList.add('hidden');
                uiElements.gameOverScreen.classList.remove('hidden');
                uiElements.finalScoreDisplay.textContent = score;
                
                if (score > highScore) {
                    highScore = score;
                    localStorage.setItem('aeroFighterHighScore', highScore);
                    uiElements.highScoreDisplay.textContent = highScore;
                }
            }
            
            function updateUIDisplay() {
                const elapsedTime = Math.floor((Date.now() - gameStartTime) / 1000);
                uiElements.scoreDisplay.textContent = `Pontos: ${score}`;
                uiElements.timeDisplay.textContent = `Tempo: ${elapsedTime}s`;
                const healthPercentage = (player.health / playerSettings.maxHealth) * 100;
                uiElements.healthBarFill.style.width = `${healthPercentage}%`;
            }
            
            // --- LÓGICA DE DIFICULDADE E INIMIGOS ---
            function spawnEnemies() {
                const now = Date.now();
                const elapsedTimeInSeconds = (now - gameStartTime) / 1000;
                
                // Diminui o cooldown de spawn com o tempo, até um mínimo
                spawnCooldown = Math.max(250, 2000 - elapsedTimeInSeconds * 25);

                if (now - lastSpawnTime > spawnCooldown) {
                    lastSpawnTime = now;
                    const health = 1 + Math.floor(elapsedTimeInSeconds / 20); // Mais vida a cada 20s
                    let pattern = 'single';
                    if (elapsedTimeInSeconds > 60) pattern = Math.random() < 0.3 ? 'burst' : (Math.random() < 0.5 ? 'spread' : 'single');
                    else if (elapsedTimeInSeconds > 25) pattern = Math.random() < 0.4 ? 'spread' : 'single';
                    
                    enemies.push({
                        x: Math.random() * (canvas.width - 40), y: -50,
                        width: 40, height: 40, health: health, maxHealth: health,
                        speed: 1.5 + Math.random() * 1.5,
                        vx: 0, vy: 0, shootPattern: pattern,
                        shootCooldown: 2500 - (elapsedTimeInSeconds * 10), lastShotTime: now
                    });
                }
            }

            const enemyShootingPatterns = {
                single: (enemy) => {
                    enemyProjectiles.push({ x: enemy.x + enemy.width / 2 - 2.5, y: enemy.y + enemy.height, width: 5, height: 15, speed: 4 });
                },
                spread: (enemy) => {
                    enemyProjectiles.push({ x: enemy.x + enemy.width / 2 - 2.5, y: enemy.y + enemy.height, width: 8, height: 8, speed: 3.5, vx: -1 });
                    enemyProjectiles.push({ x: enemy.x + enemy.width / 2 - 2.5, y: enemy.y + enemy.height, width: 8, height: 8, speed: 3.5, vx: 1 });
                },
                burst: (enemy) => {
                     enemyProjectiles.push({ x: enemy.x + enemy.width / 2 - 2.5, y: enemy.y + enemy.height, width: 5, height: 10, speed: 5 });
                     setTimeout(() => {
                         if (enemies.includes(enemy)) { // Garante que o inimigo ainda existe
                             enemyProjectiles.push({ x: enemy.x + enemy.width / 2 - 2.5, y: enemy.y + enemy.height, width: 5, height: 10, speed: 5 });
                         }
                     }, 150);
                }
            };
            
            function updateEnemies() {
                enemies.forEach(enemy => {
                    if (enemy.y < 50) enemy.y += enemy.speed; else {
                        if (enemy.vx === 0) enemy.vx = (Math.random() - 0.5) * 2;
                        enemy.x += enemy.vx;
                    }
                    if (enemy.x <= 0 || enemy.x + enemy.width >= canvas.width) enemy.vx *= -1;
                    
                    const now = Date.now();
                    if (now - enemy.lastShotTime > enemy.shootCooldown) {
                        if (Math.random() < 0.5) enemyShootingPatterns[enemy.shootPattern](enemy);
                        enemy.lastShotTime = now;
                    }
                    if (enemy.y > canvas.height) enemies.splice(enemies.indexOf(enemy), 1);
                });
            }

            // --- POWER-UPS ---
            function spawnPowerup(x, y) {
                if (Math.random() > 0.15) return; // 15% de chance de dropar um power-up
                const type = Math.random() > 0.4 ? 'shotCount' : 'shotSpeed'; // Mais chance de vir tiro
                powerups.push({ x, y, width: 30, height: 30, type, speed: 2 });
            }

            function updatePowerups() {
                powerups.forEach((p, index) => {
                    p.y += p.speed;
                    if (p.y > canvas.height) powerups.splice(index, 1);
                });
            }

            function applyPowerup(type) {
                if (type === 'shotCount' && player.shotCount < 5) player.shotCount++;
                if (type === 'shotSpeed') player.projectileSpeed += 0.5;
            }

            // --- LÓGICA DO JOGADOR ---
            function updatePlayer(now) {
                if (player.isHit && now - player.lastHitTime > playerSettings.hitInvincibilityDuration) player.isHit = false;
                if ((keys.w) && player.y > 0) player.y -= player.speed;
                if ((keys.s) && player.y < canvas.height - player.height) player.y += player.speed;
                if ((keys.a) && player.x > 0) player.x -= player.speed;
                if ((keys.d) && player.x < canvas.width - player.width) player.x += player.speed;
                
                if ((keys.j || mouse.down) && now - playerSettings.lastShotTime > playerSettings.shootCooldown) {
                    fireProjectiles();
                    playerSettings.lastShotTime = now;
                }
                
                if (keys.f && now - playerSettings.lastSpecialTime > playerSettings.specialCooldown) {
                    fireSuperWeapon();
                    playerSettings.lastSpecialTime = now;
                }
            }

            function fireProjectiles() {
                const s = player.projectileSpeed;
                const x = player.x + player.width / 2;
                const y = player.y;

                switch (player.shotCount) {
                    case 2:
                        projectiles.push({ x: x - 10, y, width: 5, height: 20, speed: s });
                        projectiles.push({ x: x + 5, y, width: 5, height: 20, speed: s });
                        break;
                    case 3:
                        projectiles.push({ x: x - 5, y, width: 6, height: 18, speed: s });
                        projectiles.push({ x: x - 15, y, width: 6, height: 18, speed: s, vx: -0.5 });
                        projectiles.push({ x: x + 5, y, width: 6, height: 18, speed: s, vx: 0.5 });
                        break;
                    case 4:
                        projectiles.push({ x: x - 18, y, width: 7, height: 16, speed: s, vx: -0.2 });
                        projectiles.push({ x: x - 6, y, width: 7, height: 16, speed: s, vx: 0.2 });
                        projectiles.push({ x: x + 6, y, width: 7, height: 16, speed: s, vx: -0.2 });
                        projectiles.push({ x: x + 18, y, width: 7, height: 16, speed: s, vx: 0.2 });
                        break;
                    case 5:
                        projectiles.push({ x: x - 5, y, width: 8, height: 15, speed: s });
                        projectiles.push({ x: x - 25, y, width: 8, height: 15, speed: s, vx: -0.8 });
                        projectiles.push({ x: x - 10, y, width: 8, height: 15, speed: s, vx: -0.3 });
                        projectiles.push({ x: x + 2, y, width: 8, height: 15, speed: s, vx: 0.3 });
                        projectiles.push({ x: x + 17, y, width: 8, height: 15, speed: s, vx: 0.8 });
                        break;
                }
            }
            
            function fireSuperWeapon() {
                score += enemies.length * 50; // Dá um bônus por cada nave destruída
                enemies = [];
                enemyProjectiles = [];
                // Efeito visual simples: flash na tela
                ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }

            // --- LÓGICA DE PROJÉTEIS E COLISÕES ---
            function updateProjectiles() {
                projectiles.forEach((p, index) => {
                    p.y -= p.speed;
                    if(p.vx) p.x += p.vx * (p.speed / 2); // Movimento angular
                    if (p.y < 0 || p.x < 0 || p.x > canvas.width) projectiles.splice(index, 1);
                });

                enemyProjectiles.forEach((p, index) => {
                    p.y += p.speed;
                    if(p.vx) p.x += p.vx;
                    if (p.y > canvas.height) enemyProjectiles.splice(index, 1);
                });
            }
            
            function checkCollisions() {
                // Projéteis do jogador vs Inimigos
                for (let i = projectiles.length - 1; i >= 0; i--) {
                    for (let j = enemies.length - 1; j >= 0; j--) {
                        if (isColliding(projectiles[i], enemies[j])) {
                            projectiles.splice(i, 1);
                            enemies[j].health--;
                            if (enemies[j].health <= 0) {
                                spawnPowerup(enemies[j].x, enemies[j].y);
                                enemies.splice(j, 1);
                                score += 100;
                            }
                            break; 
                        }
                    }
                }
                // Colisão Jogador vs Powerups
                for (let i = powerups.length - 1; i >= 0; i--) {
                     if (isColliding(player, powerups[i])) {
                        applyPowerup(powerups[i].type);
                        powerups.splice(i, 1);
                     }
                }
                // Dano no jogador
                if (!player.isHit) {
                    const hitables = [...enemyProjectiles, ...enemies];
                    for (let i = hitables.length - 1; i >= 0; i--) {
                        if (isColliding(hitables[i], player)) {
                            handlePlayerHit();
                            if (hitables[i].health) hitables.splice(i, 1); // Se for um inimigo
                            else enemyProjectiles.splice(i, 1); // Se for um projétil
                            if (gameOver) return;
                            break;
                        }
                    }
                }
            }

            function handlePlayerHit() {
                player.health--;
                player.isHit = true;
                player.lastHitTime = Date.now();
                if (player.health <= 0) endGame();
            }
            
            function isColliding(rect1, rect2) {
                if (!rect1 || !rect2) return false;
                return rect1.x < rect2.x + rect2.width && rect1.x + rect1.width > rect2.x &&
                       rect1.y < rect2.y + rect2.height && rect1.y + rect1.height > rect2.y;
            }

            // --- FUNÇÕES DE DESENHO ---
            function draw() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = player.isHit ? '#ffffff' : '#0af';
                ctx.fillRect(player.x, player.y, player.width, player.height);
                
                ctx.fillStyle = projectileColors[player.shotCount - 2] || '#FF00FF';
                projectiles.forEach(p => ctx.fillRect(p.x, p.y, p.width, p.height));
                
                enemies.forEach(e => {
                    ctx.fillStyle = `rgb(255, ${Math.floor(255 * (e.health / e.maxHealth))}, ${Math.floor(255 * (e.health / e.maxHealth))})`;
                    ctx.fillRect(e.x, e.y, e.width, e.height);
                });
                
                ctx.fillStyle = '#f90';
                enemyProjectiles.forEach(p => ctx.fillRect(p.x, p.y, p.width, p.height));

                powerups.forEach(p => {
                    ctx.fillStyle = p.type === 'shotCount' ? '#00FFFF' : '#FFD700'; // Ciano para tiro, Dourado para velocidade
                    ctx.beginPath();
                    ctx.arc(p.x + p.width / 2, p.y + p.height / 2, p.width / 2, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.fillStyle = "#000";
                    ctx.font = "bold 20px Arial";
                    ctx.textAlign = "center";
                    ctx.textBaseline = "middle";
                    ctx.fillText(p.type === 'shotCount' ? '+' : 'S', p.x + p.width/2, p.y + p.height/2 + 2);
                });
            }

            // --- GAME LOOP PRINCIPAL ---
            function gameLoop() {
                if (gameOver) return;
                const now = Date.now();
                spawnEnemies();
                updatePlayer(now);
                updateProjectiles();
                updateEnemies();
                updatePowerups();
                checkCollisions();
                updateUIDisplay();
                draw();
                requestAnimationFrame(gameLoop);
            }
            
            // --- EVENT LISTENERS ---
            uiElements.startBtn.addEventListener('click', initGame);
            uiElements.restartBtn.addEventListener('click', initGame);

            window.addEventListener('keydown', (e) => { const key = e.key.toLowerCase(); if(keys.hasOwnProperty(key)) keys[key] = true; });
            window.addEventListener('keyup', (e) => { const key = e.key.toLowerCase(); if(keys.hasOwnProperty(key)) keys[key] = false; });
            canvas.addEventListener('mousedown', (e) => { if (e.button === 0) mouse.down = true; });
            canvas.addEventListener('mouseup', (e) => { if (e.button === 0) mouse.down = false; });
            canvas.addEventListener('mouseleave', () => mouse.down = false); // Para de atirar se o mouse sair da tela
            
            if (isMobile) {
                function setupVirtualButton(buttonId, keyName) {
                    const btn = document.getElementById(buttonId);
                    btn.addEventListener('touchstart', (e) => { e.preventDefault(); keys[keyName] = true; });
                    btn.addEventListener('touchend', (e) => { e.preventDefault(); keys[keyName] = false; });
                }
                setupVirtualButton('up-btn', 'w'); setupVirtualButton('down-btn', 's');
                setupVirtualButton('left-btn', 'a'); setupVirtualButton('right-btn', 'd');
                setupVirtualButton('shoot-btn', 'j'); setupVirtualButton('special-btn', 'f');
            }
        };
    </script>
</body>
</html>
